# ============================================================================
# ParchMark OIDC Configuration Example
# ============================================================================
# Copy this file to .env.docker or appropriate environment file
# Fill in values specific to your deployment

# ============================================================================
# EXISTING VARIABLES (Keep these as-is or adjust for your environment)
# ============================================================================

# Database
DATABASE_URL=postgresql://parchmark_user:parchmark_password@postgres:5432/parchmark_db

# Backend
# Generate a secure secret key: python -c "import secrets; print(secrets.token_urlsafe(32))"
# Must be at least 32 characters
SECRET_KEY=your-secret-key-here-change-in-production-minimum-32-characters-required
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
REFRESH_TOKEN_EXPIRE_DAYS=7
HOST=0.0.0.0
PORT=8000
ENVIRONMENT=development

# CORS
ALLOWED_ORIGINS=http://localhost:5173,http://localhost:8080,https://notes.engen.tech

# ============================================================================
# OIDC VARIABLES
# ============================================================================

# Authelia OIDC Configuration
# The issuer URL of your Authelia instance
OIDC_ISSUER_URL=https://auth.engen.tech

# The OIDC client ID registered in Authelia
# Must be registered as a "public" OIDC client in Authelia config
OIDC_AUDIENCE=parchmark-web

# The JWT claim to use for username extraction
# Supports: "preferred_username" (recommended) or "email"
# Falls back to email if preferred_username not present
OIDC_USERNAME_CLAIM=preferred_username

# ============================================================================
# OPTIONAL VARIABLES (For future use)
# ============================================================================

# Token validation timeout (seconds)
# Increase if Authelia JWKS fetch is slow
# OIDC_TOKEN_VALIDATION_TIMEOUT=30

# JWKS cache TTL (seconds)
# How long to cache JWKS before refreshing
# OIDC_JWKS_CACHE_TTL=3600

# ============================================================================
# DEVELOPMENT NOTES
# ============================================================================

# Local Development:
# - Set OIDC_ISSUER_URL to your Authelia instance (can be development)
# - ALLOWED_ORIGINS should include http://localhost:5173
# - Both local and OIDC login are supported simultaneously

# Docker Development:
# - Authelia runs in separate container
# - Use service names or docker host IP (host.docker.internal)
# - Example: OIDC_ISSUER_URL=http://authelia:9091

# Production:
# - Use https URLs only
# - Set strong SECRET_KEY (use: python -c "import secrets; print(secrets.token_urlsafe(32))")
# - Set ENVIRONMENT=production for security

# ============================================================================
# AUTHELIA OIDC CLIENT CONFIGURATION (for reference)
# ============================================================================

# In authelia/configuration.yml, register parchmark-web client:
#
# identity_providers:
#   oidc:
#     clients:
#       - id: parchmark-web
#         secret: ~  # Public client (no secret)
#         public: true
#         description: ParchMark Note-Taking Application
#         redirect_uris:
#           - https://notes.engen.tech/oidc/callback
#           - http://localhost:5173/oidc/callback
#         scopes:
#           - openid
#           - profile
#           - email
#         grant_types:
#           - authorization_code
#           - refresh_token
#         response_types:
#           - code
#         require_pkce: true
#         pkce_challenge_method: S256
#         userinfo_signed_response_alg: none

# ============================================================================
# FRONTEND ENVIRONMENT VARIABLES (.env in ui/ directory)
# ============================================================================

# VITE_API_URL=/api
# VITE_TOKEN_WARNING_SECONDS=60
#
# OIDC Configuration
# VITE_OIDC_ISSUER_URL=https://auth.engen.tech
# VITE_OIDC_CLIENT_ID=parchmark-web
# VITE_OIDC_REDIRECT_URI=https://notes.engen.tech/oidc/callback
# VITE_OIDC_LOGOUT_REDIRECT_URI=https://notes.engen.tech/login

# ============================================================================
# VERIFICATION CHECKLIST
# ============================================================================

# Before deploying, verify:
# [ ] OIDC_ISSUER_URL is reachable and returns valid OIDC discovery endpoint
# [ ] OIDC_AUDIENCE matches the client ID registered in Authelia
# [ ] Database migrations have been applied (oidc_sub, email, auth_provider columns)
# [ ] ALLOWED_ORIGINS includes the frontend domain
# [ ] Frontend environment variables are set correctly
# [ ] Both local and OIDC users can login in hybrid mode
