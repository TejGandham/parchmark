{"id":"parchmark-1ap","title":"Extract business logic from routers to Service layer","description":"Backend business logic (e.g., markdown processing, note creation logic) sits directly in Routers. This couples concerns and complicates unit testing.\n\n**Current state:**\n- Routers handle HTTP concerns AND business logic\n- Direct DB session dependency in routers\n- Hard to test business logic in isolation\n\n**Recommendation:**\n1. Create a Service layer (e.g., backend/app/services/notes_service.py)\n2. Move business logic out of routers\n3. Consider Repository pattern for data access abstraction\n\n**Benefits:**\n- Better testability (mock services, not HTTP)\n- Clearer separation of concerns\n- Easier to reuse logic across endpoints","status":"tombstone","priority":3,"issue_type":"feature","owner":"46010260+TejGandham@users.noreply.github.com","created_at":"2026-01-28T23:27:46.972015-05:00","created_by":"Tej","updated_at":"2026-01-29T15:09:41.70429-05:00","deleted_at":"2026-01-29T15:09:41.70429-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature"}
{"id":"parchmark-1ro","title":"Create NotesLayout component","status":"closed","priority":2,"issue_type":"task","owner":"46010260+TejGandham@users.noreply.github.com","created_at":"2026-01-29T21:59:40.070874-05:00","created_by":"Tej","updated_at":"2026-01-29T22:00:57.155663-05:00","closed_at":"2026-01-29T22:00:57.155663-05:00","close_reason":"Closed"}
{"id":"parchmark-28q","title":"Timestamp-based note IDs risk collisions","description":"Note IDs are generated as `note-{milliseconds}` (backend/app/routers/notes.py:82-93) stored in a 50-char PK (backend/app/models/models.py:52-55). Concurrent writes on multiple nodes or fast clients can collide and cause 500 errors.\n\n**Files affected:**\n- backend/app/routers/notes.py:82-93\n- backend/app/models/models.py:52-55\n\n**Fix:**\nUse UUID4 or ULID generated server-side, or a DB-generated PK.\n\n**Impact:** Low - rare but possible collision under concurrent writes","status":"tombstone","priority":3,"issue_type":"bug","owner":"46010260+TejGandham@users.noreply.github.com","created_at":"2026-01-28T23:27:45.909359-05:00","created_by":"Tej","updated_at":"2026-01-29T15:09:41.70429-05:00","deleted_at":"2026-01-29T15:09:41.70429-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug"}
{"id":"parchmark-2c0","title":"Create RouteError boundary","status":"closed","priority":2,"issue_type":"task","owner":"46010260+TejGandham@users.noreply.github.com","created_at":"2026-01-29T21:54:07.590596-05:00","created_by":"Tej","updated_at":"2026-01-29T21:54:52.953445-05:00","closed_at":"2026-01-29T21:54:52.953445-05:00","close_reason":"Closed"}
{"id":"parchmark-2fk","title":"Update Sidebar for data router actions","status":"closed","priority":2,"issue_type":"task","owner":"46010260+TejGandham@users.noreply.github.com","created_at":"2026-01-29T22:03:35.895917-05:00","created_by":"Tej","updated_at":"2026-01-29T22:13:58.089559-05:00","closed_at":"2026-01-29T22:13:58.089559-05:00","close_reason":"Closed"}
{"id":"parchmark-36c","title":"Auth tokens stored in localStorage vulnerable to XSS","description":"Zustand persist stores access_token and refresh_token in browser localStorage (ui/src/features/auth/store/auth.ts:286-294), exposing them to any XSS attack and enabling long-lived token theft.\n\n**Files affected:**\n- ui/src/features/auth/store/auth.ts:51-304 (partialize block at 286-294)\n\n**Mitigation options:**\n1. Keep tokens in HTTP-only secure cookies (requires backend changes)\n2. Use in-memory store plus short-lived access tokens\n3. Implement rotating refresh tokens\n\n**Impact:** High - security vulnerability, tokens can be stolen via XSS","status":"tombstone","priority":1,"issue_type":"bug","owner":"46010260+TejGandham@users.noreply.github.com","created_at":"2026-01-28T23:27:43.954863-05:00","created_by":"Tej","updated_at":"2026-01-29T15:09:41.70429-05:00","deleted_at":"2026-01-29T15:09:41.70429-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug"}
{"id":"parchmark-42o","title":"Update create_note endpoint: honor client title","status":"closed","priority":2,"issue_type":"task","owner":"46010260+TejGandham@users.noreply.github.com","created_at":"2026-01-29T17:50:51.355166-05:00","created_by":"Tej","updated_at":"2026-01-29T17:51:25.615308-05:00","closed_at":"2026-01-29T17:51:25.615308-05:00","close_reason":"Closed","dependencies":[{"issue_id":"parchmark-42o","depends_on_id":"parchmark-9s1","type":"blocks","created_at":"2026-01-29T17:50:55.724226-05:00","created_by":"Tej"}]}
{"id":"parchmark-6gu","title":"App startup continues when DB init fails","description":"init_database() exceptions are swallowed and the app still starts (backend/app/main.py:33-47), leading to runtime 500s once requests hit uninitialized tables.\n\n**Files affected:**\n- backend/app/main.py:33-47\n\n**Fix:**\n1. Re-raise exception or sys.exit(1) on init failure\n2. Surface readiness via health check endpoint\n3. Fail fast to prevent serving broken requests\n\n**Impact:** Medium - silent failures lead to confusing runtime errors","status":"tombstone","priority":2,"issue_type":"bug","owner":"46010260+TejGandham@users.noreply.github.com","created_at":"2026-01-28T23:27:44.667614-05:00","created_by":"Tej","updated_at":"2026-01-29T15:09:41.70429-05:00","deleted_at":"2026-01-29T15:09:41.70429-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug"}
{"id":"parchmark-7po","title":"Add tests for explicit title in create_note","status":"closed","priority":2,"issue_type":"task","owner":"46010260+TejGandham@users.noreply.github.com","created_at":"2026-01-29T17:50:52.112428-05:00","created_by":"Tej","updated_at":"2026-01-29T17:53:56.044198-05:00","closed_at":"2026-01-29T17:53:56.044198-05:00","close_reason":"Closed","dependencies":[{"issue_id":"parchmark-7po","depends_on_id":"parchmark-42o","type":"blocks","created_at":"2026-01-29T17:50:55.798864-05:00","created_by":"Tej"}]}
{"id":"parchmark-92d","title":"Create router configuration with loaders","status":"closed","priority":2,"issue_type":"task","owner":"46010260+TejGandham@users.noreply.github.com","created_at":"2026-01-29T21:54:09.814582-05:00","created_by":"Tej","updated_at":"2026-01-29T21:58:34.827458-05:00","closed_at":"2026-01-29T21:58:34.827458-05:00","close_reason":"Closed"}
{"id":"parchmark-9s1","title":"Update NoteCreate schema: make title optional","status":"closed","priority":2,"issue_type":"task","owner":"46010260+TejGandham@users.noreply.github.com","created_at":"2026-01-29T17:50:50.653692-05:00","created_by":"Tej","updated_at":"2026-01-29T17:51:05.491228-05:00","closed_at":"2026-01-29T17:51:05.491228-05:00","close_reason":"Closed"}
{"id":"parchmark-9te","title":"Blocking DB calls in async routes cause thread starvation","description":"All routers use async def but call synchronous SessionLocal directly inside the event loop. Under load, each query blocks the worker thread, hurting throughput and latency.\n\n**Files affected:**\n- backend/app/database/database.py:26-44\n- backend/app/routers/notes.py:26-205\n- backend/app/routers/auth.py:32-154\n- backend/app/routers/settings.py:31-233\n\n**Fix options:**\n1. Convert handlers to sync `def` (letting FastAPI run them in a threadpool)\n2. Migrate to SQLAlchemy AsyncEngine/AsyncSession with `await session.execute` and `async_sessionmaker`\n\n**Impact:** High - affects all API endpoints under concurrent load","status":"tombstone","priority":1,"issue_type":"bug","owner":"46010260+TejGandham@users.noreply.github.com","created_at":"2026-01-28T23:27:43.060048-05:00","created_by":"Tej","updated_at":"2026-01-29T15:09:41.70429-05:00","deleted_at":"2026-01-29T15:09:41.70429-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug"}
{"id":"parchmark-aku","title":"Create notes actions for data router","status":"closed","priority":2,"issue_type":"task","owner":"46010260+TejGandham@users.noreply.github.com","created_at":"2026-01-29T21:54:09.072489-05:00","created_by":"Tej","updated_at":"2026-01-29T21:57:03.4508-05:00","closed_at":"2026-01-29T21:57:03.4508-05:00","close_reason":"Closed"}
{"id":"parchmark-d88","title":"Fix 71 failing backend tests after async SQLAlchemy migration","description":"Tests pass without hanging after TRUNCATEâ†’DELETE fix, but 71 integration tests fail with database connection errors.\n\nRoot cause: The app creates global async_engine at module import time before test fixtures can set DATABASE_URL. When routes execute, the test session override works, but init_database() on app startup uses the wrong engine.\n\nErrors observed:\n1. psycopg2.OperationalError: password auth failed for 'postgres' (init_database)\n2. asyncpg.InvalidPasswordError: password auth failed for 'test' (route handlers)\n\nFailing tests: All notes router integration tests (43 tests) plus related tests.\n\nFix options:\n1. Set DATABASE_URL before app import using pytest plugin/conftest_configure\n2. Make database.py lazily initialize engines\n3. Create testcontainer in session-level conftest fixture that runs before app import\n\nRelated: PR #48 async-sqlalchemy-migration branch","status":"closed","priority":1,"issue_type":"bug","owner":"46010260+TejGandham@users.noreply.github.com","created_at":"2026-01-29T15:58:45.159813-05:00","created_by":"Tej","updated_at":"2026-01-29T16:22:59.366179-05:00","closed_at":"2026-01-29T16:22:59.366179-05:00","close_reason":"Fixed async test failures by using render_as_string(hide_password=False) and NullPool"}
{"id":"parchmark-dbh","title":"Fix OIDC opaque token authentication","status":"closed","priority":1,"issue_type":"bug","owner":"46010260+TejGandham@users.noreply.github.com","created_at":"2026-02-13T23:43:16.111721-05:00","created_by":"Tej","updated_at":"2026-02-13T23:50:35.562941-05:00","closed_at":"2026-02-13T23:50:35.562941-05:00","close_reason":"Implemented opaque token support via userinfo endpoint validation. Added is_opaque_token(), get_discovery_document(), validate_opaque_token() to oidc_validator.py. Updated dependencies.py to route opaque tokens. All 22 tests pass."}
{"id":"parchmark-hl7","title":"Update App.tsx to use RouterProvider","status":"closed","priority":2,"issue_type":"task","owner":"46010260+TejGandham@users.noreply.github.com","created_at":"2026-01-29T21:59:41.713176-05:00","created_by":"Tej","updated_at":"2026-01-29T22:02:52.909621-05:00","closed_at":"2026-01-29T22:02:52.909621-05:00","close_reason":"Closed"}
{"id":"parchmark-npa","title":"Delete obsolete files replaced by data router","status":"closed","priority":2,"issue_type":"task","owner":"46010260+TejGandham@users.noreply.github.com","created_at":"2026-01-29T22:03:36.684313-05:00","created_by":"Tej","updated_at":"2026-01-29T22:15:02.485357-05:00","closed_at":"2026-01-29T22:15:02.485357-05:00","close_reason":"Closed"}
{"id":"parchmark-q90","title":"Export endpoint loads entire dataset into memory","description":"/settings/export-notes builds a full in-memory list and ZIP (backend/app/routers/settings.py:113-179), which will OOM or stall for large accounts.\n\n**Files affected:**\n- backend/app/routers/settings.py:113-179\n\n**Fix options:**\n1. Stream notes using chunked query + zipstream/StreamingResponse generator\n2. Enforce pagination/size limits\n3. Background job for large exports with download link\n\n**Impact:** Medium - will crash or hang for users with many notes","status":"tombstone","priority":2,"issue_type":"bug","owner":"46010260+TejGandham@users.noreply.github.com","created_at":"2026-01-28T23:27:45.197701-05:00","created_by":"Tej","updated_at":"2026-01-29T15:09:41.70429-05:00","deleted_at":"2026-01-29T15:09:41.70429-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug"}
{"id":"parchmark-svk","title":"Server ignores client-supplied note title","description":"NoteCreate.title is validated (backend/app/schemas/schemas.py:54-58) but create_note discards it and re-derives title from content (backend/app/routers/notes.py:82-95), surprising clients and breaking parity with API contract.\n\n**Files affected:**\n- backend/app/schemas/schemas.py:54-58\n- backend/app/routers/notes.py:82-95\n\n**Fix options:**\n1. Honor the provided title if present\n2. Remove title from the request model if it's always derived\n\n**Impact:** Low - API contract mismatch, confusing behavior","status":"tombstone","priority":3,"issue_type":"bug","owner":"46010260+TejGandham@users.noreply.github.com","created_at":"2026-01-28T23:27:46.43897-05:00","created_by":"Tej","updated_at":"2026-01-29T15:09:41.70429-05:00","deleted_at":"2026-01-29T15:09:41.70429-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug"}
{"id":"parchmark-utb","title":"Add transaction error handling to notes router","status":"closed","priority":2,"issue_type":"bug","owner":"46010260+TejGandham@users.noreply.github.com","created_at":"2026-01-29T18:19:08.415454-05:00","created_by":"Tej","updated_at":"2026-01-29T18:19:15.950185-05:00","closed_at":"2026-01-29T18:19:15.950185-05:00","close_reason":"Fixed in PR #50. Added try/except SQLAlchemyError blocks around database mutations in notes.py (create_note, update_note, delete_note). On error: calls db.rollback(), logs error with context, returns HTTP 500 with 'Database error' message. Added 6 unit tests covering commit/refresh/delete failure scenarios. Note: rollback after successful commit+failed refresh has no effect since data is already persisted, but is safe to call."}
{"id":"parchmark-x2j","title":"Simplify notes store to UI-only state","status":"closed","priority":2,"issue_type":"task","owner":"46010260+TejGandham@users.noreply.github.com","created_at":"2026-01-29T21:59:40.922963-05:00","created_by":"Tej","updated_at":"2026-01-29T22:01:57.0207-05:00","closed_at":"2026-01-29T22:01:57.0207-05:00","close_reason":"Closed"}
{"id":"parchmark-y84","title":"Consider TanStack Query for server state management","description":"Frontend uses manual API state (loading/error) tracking in Zustand stores, which is repetitive boilerplate.\n\n**Current state:**\n- ui/src/features/notes/store/notes.ts manually tracks loading, error states\n- Each async action needs isLoading, error handling\n- No automatic caching, refetching, or stale-while-revalidate\n\n**Recommendation:**\nAdopt TanStack Query (React Query) for server-state management:\n- Automatic caching and background refetching\n- Built-in loading/error states\n- Optimistic updates\n- Deduplication of requests\n\n**Trade-off:**\n- Migration effort\n- Another dependency\n- Zustand still useful for client-only state (UI preferences, sidebar)\n\n**Priority:** Backlog - nice to have, not urgent","status":"tombstone","priority":4,"issue_type":"feature","owner":"46010260+TejGandham@users.noreply.github.com","created_at":"2026-01-28T23:27:47.505401-05:00","created_by":"Tej","updated_at":"2026-01-29T15:09:41.70429-05:00","deleted_at":"2026-01-29T15:09:41.70429-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"feature"}
{"id":"parchmark-z24","title":"Update NoteContent for data router hooks","status":"closed","priority":2,"issue_type":"task","owner":"46010260+TejGandham@users.noreply.github.com","created_at":"2026-01-29T22:03:35.110723-05:00","created_by":"Tej","updated_at":"2026-01-29T22:11:10.641241-05:00","closed_at":"2026-01-29T22:11:10.641241-05:00","close_reason":"Closed"}
